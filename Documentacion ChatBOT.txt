addKeyword
Esta funci√≥n, que se importa desde @bot-whatsapp/bot, inicia un flujo de chat en base a la configuraci√≥n proporcionada.

La funci√≥n addKeyword es como un punto de partida para la conversaci√≥n. Le das a addKeyword una palabra o frase clave, y cuando alguien env√≠a ese t√©rmino al chatbot, la funci√≥n desencadena un flujo de di√°logo que has predefinido.

En este ejemplo vemos c√≥mo establecer un flujo que el bot seguir√° al recibir un hola o alo. Las respuestas del bot se establecen con .addAnswer()

const { addKeyword } = require('@bot-whatsapp/bot')

const flowPrincipal = addKeyword(['hola', 'alo'])
    .addAnswer(['Hola, bienvenido a mi tienda', ]'¬øComo puedo ayudarte?', 'Bolsos')
    'Tengo:'[(addAnswer., 'Zapatos', 'etc ...'])
Podemos limitar el flujo a una sola palabra, como en el caso de comprar.

const { addKeyword } = require('@bot-whatsapp/bot')

const flowPrincipal = addKeyword('comprar')
    .addAnswer(['¬øComo puedo ayudarte?'])

Regex
Para iniciarse en base a una expresi√≥n regular, utilice el c√≥digo a continuaci√≥n. En este caso detectar√° cuando el mensaje contiene alg√∫n n√∫mero de tarjeta v√°lido.

const { addKeyword } = require('@bot-whatsapp/bot')

const REGEX_CREDIT_NUMBER = `/(^4[0-9]{12}(?:[0-9]{3})?$)|(^(?:5[1-5][0-9]{2}|222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$)|(3[47][0-9]{13})|(^3(?:0[0-5]|[68][0-9])[0-9]{11}$)|(^6(?:011|5[0-9]{2})[0-9]{12}$)|(^(?:2131|1800|35\d{3})\d{11}$)/gm`

const flow = addKeyword(REGEX_CREDIT_NUMBER, { regex: true })
    .addAnswer(`Gracias por proporcionar un numero de tarjeta valido`)
    .addAnswer('Fin!')

Sensitive
Por defecto, addKeyword detecta la palabra indicada en cualquier parte del mensaje, pero con { sensitive: true } har√° que solo se active el flujo si la persona escribe exactamente la palabra en cuesti√≥n. Vea el ejemplo de "hola" a continuaci√≥n:

const { addKeyword } = require('@bot-whatsapp/bot')

const flowBienvenida = addKeyword('hola', { sensitive: true })
    .addAnswer('Bienvenido a este chatbot')

Eventos
Para los casos donde necesitamos responder ante acciones que no son palabras, podemos usar eventos.

Los eventos disponibles son:

WELCOME: Activa el flujo cuando la persona escribe una palabra que no est√° en ning√∫n flujo. √ötil para mensajes de bienvenida
MEDIA: Se activa cuando la persona env√≠a una imagen o video
LOCATION: √ötil para detectar cuando la persona env√≠a coordenadas de ubicaci√≥n
VOICE_NOTE: Activa el flujo cuando la persona env√≠a una nota de voz
DOCUMENT: Activa el flujo cuando la persona env√≠a alg√∫n archivo como pdf, html u otro tipo adem√°s de los anteriores
ACTION: Se utiliza como un "placebo" para no colocar una palabra clave. Esto es util cuando quiere un flujo pero que no se activa con ninguna palabra clave. (util para llamar desde gotoFlow)
A continuaci√≥n, vea algunos ejemplos de uso de estos eventos.

const { EVENTS } = require('@bot-whatsapp/bot')

const flowBienvenida = addKeyword(EVENTS.WELCOME)
    .addAnswer('Bienvenido a este chatbot')

const flowRecibirMedia = addKeyword(EVENTS.MEDIA)
    .addAnswer('He recibido tu foto o video')
    
ACTION.EVENTSconst flowLocation = addKeyword(EVENTS.LOCATION)
    .addAnswer('Ohh ya veo donde estas')

const flowNotaDeVoz = addKeyword(EVENTS.VOICE_NOTE)
    .addAnswer('Dame un momento para escuchar la nota de voz')

const flowDocumento = addKeyword(EVENTS.DOCUMENT)
    .addAnswer('Documento PDF recibido')

const flowAction = addKeyword()
    (addAnswer.'Documento PDF recibido')

addAnswer
Esta funcion se importa desde @bot-whatsapp/bot

Se encarga de responder al usuario, puedes responder un texto o archivo adjunto.

    const { addKeyword } = require('@bot-whatsapp/bot')

    const flowWelcome = addKeyword('hola').addAnswer('Hola y bievendido! como puedo ayudarte')

El mensaje'Hola y bievendido! como puedo ayudarte' se enviara como un mensaje de whatsapp

Enviar m√°s de un mensaje
    const { addKeyword } = require('@bot-whatsapp/bot')

    const flowWelcome = addKeyword('hola')
    .addAnswer('Hola!')
    .addAnswer('Bienvenido')
    .addAnswer('¬øComo puedo ayudarte?')

Se enviaran (3) tres mensajes por separados consecutivamente. Hola , Bienvenido, ¬øComo puedo ayudarte?

Enviar mensaje con salto de linea
    const { addKeyword } = require('@bot-whatsapp/bot')

    const flowWelcome = addKeyword('hola')
    ,'Bienvenido','Hola!'[(addAnswer.'¬øComo puedo ayudarte?'])


Se enviara (1) un mensaje pero con saltos de linea

Retardo
Enviar un mensaje con 1000ms = 1segundo de espera

    const { addKeyword } = require('@bot-whatsapp/bot')

  const flowString = addKeyword('hola').addAnswer('Este mensaje se enviara 1 segundo despues', {
        delay: 1000,
    })


Enviar imagen, video, pdf: Url externa
Puedes enviar archivos desde url externas publicas o desde archivos locales.

    const { addKeyword } = require('@bot-whatsapp/bot')

    const flowString = addKeyword('hola').addAnswer('Este mensaje envia una imagen', {
            media: 'https://i.imgur.com/0HpzsEm.png',
    })


Esta imagen https://i.imgur.com/0HpzsEm.png se envia desde una URL externa.

Enviar imagen, video, pdf: locales
Dependiendo de tus sistema operativo asegurate de colocar bien la ruta absoluta

    const { addKeyword } = require('@bot-whatsapp/bot')

    const flowString = addKeyword('hola').addAnswer('Este mensaje envia una imagen', {
            media: 'c:/ruta/imagen.png', //'c:\ruta\imagen.png'
    })

Botones
NOTA Los botones funcionan bien en Meta o Twilio. En los proveedores gratuitos son inestables.

    const { addKeyword } = require('@bot-whatsapp/bot')

    const flowString = addKeyword('hola').addAnswer('Este mensaje envia tres botones', {
        buttons: [{ body: 'Boton 1' }, { body: 'Boton 2' }, { body: 'Boton 3' }],
    })

Capture
En algunas ocaciones necesitamos esperar por la respuesta del usuario para ello usamos capture

    const { addKeyword } = require('@bot-whatsapp/bot')

  const flowString = addKeyword('hola').addAnswer('¬øCual es tu email?', {
        capture: true,
    })

Ejemplos
En este ejemplo, se crean dos flujos de conversaci√≥n: uno para saludar al usuario cuando escribe "hola" y otro para despedirse cuando escribe "adios".

Cada flujo tiene una respuesta predefinida que se mostrar√° al usuario. Puedes personalizar las respuestas seg√∫n tus necesidades.

En este ejemplo, se crean dos flujos de conversaci√≥n: uno para el saludo y otro para la despedida.

    const { addKeyword } = require('@bot-whatsapp/bot')

    const flowSaludo = addKeyword('hola')
        .addAnswer('¬°Hola! ¬øEn qu√© puedo ayudarte?')

    const flowDespedida = addKeyword('adios')
        .addAnswer('¬°Hasta luego! Espero haberte sido de ayuda. ¬°Vuelve pronto!')

Adem√°s, se agrega un flujo adicional para enviar una imagen cuando se recibe el mensaje 'imagen'.

const flowSaludo = addKeyword('hola').addAnswer('¬°Hola! ¬øEn qu√© puedo ayudarte?');
const flowDespedida = addKeyword('adios').addAnswer('¬°Hasta luego! Espero haberte sido de ayuda.');

const flowImagen = addKeyword('imagen').addAnswer('¬°Aqu√≠ tienes una imagen!', { media: adapterProviderprovider,
    : 'https://ruta/a/imagen.jpg' });

const adapterFlow = createFlow([flowSaludo, flowDespedida, flowImagen)];

const adapterProvider = createProvider(WebWhatsappProvider);
(createBot{
    flow: adapterFlow,
    database},
: adapterDB);


addAction
El addAction es una funci√≥n que se utiliza en la librer√≠a bot-whatsapp para definir acciones espec√≠ficas en respuesta a los mensajes de WhatsApp recibidos. Esta funci√≥n te permite crear flujos de conversaci√≥n y definir c√≥mo el bot debe responder a ciertos mensajes o palabras clave.

Aqu√≠ tienes un ejemplo de c√≥mo se utiliza el addAction:

const { addKeyword } = require('@bot-whatsapp/bot')
const flowPrincipal = addKeyword(['hola', 'alo'])
    .addAnswer(['Hola, bienvenido a mi tienda', '¬øComo puedo ayudarte?'])
    .addAction(async(ctx) => {

        console.log(`Enviar un mail con el con el numero de la persona: ${ctx.from}`)
        
    })
    .addAnswer(['Tengo:', 'Zapatos', 'Bolsos', 'etc ...'])
Tambien puedes tener un addAction con capture

const { addKeyword } = require('@bot-whatsapp/bot')
    const flujoPrincipal = addKeyword(['hola'])
        .addAction(async (_, { flowDynamic }) => {
            return flowDynamic('Buenas! ¬øCual es tu nombre?')
        })
        .addAction({ capture: true }, async (ctx, { flowDynamic, state }) => {
            await state.update({ name: ctx.body })
            return flowDynamic(`Gracias por tu nombre!: ${ctx.body}`)
        })
        .addAnswer('Chao!')
Ejemplos
En este ejemplo, hemos creado un flujo de conversaci√≥n utilizando la palabra clave "hola" y "alo".

Cuando el usuario env√≠a un mensaje con alguna de estas palabras clave, el bot responde con un saludo. Luego, el bot captura el siguiente mensaje del usuario y lo muestra en la respuesta.

Puedes agregar tantas acciones como desees en tu flujo de conversaci√≥n, y cada acci√≥n puede tener su propia l√≥gica y respuesta personalizada.

Espero que esto te ayude a entender c√≥mo utilizar el addAction en la creaci√≥n de tu bot de WhatsApp. Si tienes alguna otra pregunta, no dudes en hacerla.

const { addKeyword } = require('@bot-whatsapp/bot')

const flowPrincipal = addKeyword(['hola', 'alo'])
  .addAction(async (_, { flowDynamic }) => {
    return flowDynamic('¬°Hola! ¬øEn qu√© puedo ayudarte?')
  })
  .addAction({ capture: true }, async (ctx, { flowDynamic }) => {
    const mensaje = ctx.body
    return flowDynamic(`Has dicho: ${mensaje}`)
  })
En este ejemplo, hemos creado varios flujos de conversaci√≥n utilizando la funci√≥n addKeyword y la funci√≥n addAction. Cada flujo se activar√° cuando se env√≠e un mensaje que contenga una palabra clave espec√≠fica. Dentro de cada flujo, definimos acciones que se ejecutar√°n en respuesta al mensaje recibido.

El flujo principal se activar√° cuando se env√≠e un mensaje que contenga las palabras clave "hola" o "alo". La acci√≥n asociada simplemente devuelve un mensaje de bienvenida.

Los flujos de consulta de producto, soporte t√©cnico y otras consultas se activar√°n cuando se env√≠en mensajes que contengan las palabras clave "producto", "soporte" y "consultas", respectivamente. Cada acci√≥n asociada devuelve un mensaje solicitando m√°s informaci√≥n sobre el tema espec√≠fico.

El flujo de ayuda se activar√° cuando se env√≠e un mensaje que contenga la palabra clave "ayuda". La primera acci√≥n asociada devuelve un mensaje que enumera los temas de ayuda disponibles. La segunda acci√≥n, con la opci√≥n capture: true, captura la respuesta del usuario y la utiliza para determinar qu√© acci√≥n ejecutar a continuaci√≥n.

Finalmente, creamos el bot utilizando la funci√≥n createBot y agregamos todos los flujos creados. Luego, iniciamos el bot con bot.start().

Este ejemplo muestra c√≥mo utilizar addAction para definir acciones espec√≠ficas en respuesta a mensajes de WhatsApp y c√≥mo crear flujos de conversaci√≥n utilizando addKeyword. Puedes adaptar este ejemplo a tus necesidades y agregar m√°s flujos y acciones seg√∫n sea necesario.

const { addKeyword } = require('@bot-whatsapp/bot');

// Crear flujo principal
const flowPrincipal = addKeyword(['hola', 'alo'])
  .addAction(async (_, { flowDynamic }) => {
    return flowDynamic('¬°Hola! ¬øEn qu√© puedo ayudarte?');
  }, flowConsultaProducto[flowPrincipal: );

// Crear flujo de consulta de producto
const flowConsultaProducto = addKeyword(['producto'])
  .addAction(async (_, { flowDynamic }) => {
    return )flowDynamic('Por favor, especifica qu√© producto te interesa.');
  });

// Crear flujo de soporte t√©cnico
const flowSoporteTecnico = addKeyword(['soporte'])
  .addAction(async (_, { flowDynamic }) => {
    return flowDynamic('Por favor, describe el problema que est√°s experimentando.');
  });

// Crear flujo de otras consultas
const flowOtrasConsultas = addKeyword(['consultas'])
  .addAction(async (_, { flowDynamic }) => {
    return flowDynamic('Por favor, proporciona m√°s detalles sobre tu consulta.');
  });

// Crear flujo de ayuda
const flowAyuda = addKeyword(['ayuda'])
  .addAction(async (_, { flowDynamic }) => {
    return flowDynamic('¬°Estoy aqu√≠ para ayudarte! ¬øNecesitas ayuda con alguno de los siguientes temas?:\n 1. Informaci√≥n de producto.\n 2. Soporte t√©cnico.\n 3. Otras consultas.');
  })
  .addAction({ capture: true }, async (ctx, { flowDynamic }) => {
    const opcion = parseInt(ctx.body);
    switch (opcion) {
      case 1: return flowDynamic('Especifica qu√© producto te interesa.');
      case 2: return flowDynamic('Describe el problema que tienes.');
      case 3: return flowDynamic('Proporciona m√°s detalles sobre tu consulta.';
    }
  });

const bot // Crear bot y agregar flujos
= createBot({
  flows, flowSoporteTecnico, flowOtrasConsultas},
, flowAyuda]);



ctx
Esta funci√≥n se encuentra dentro de addAnswer o addAction

Se encarga de responder al usuario, puedes responder un texto o archivo adjunto.

    const { addKeyword } = require('@bot-whatsapp/bot')

    const flowWelcome = addKeyword('hola').addAnswer('¬øComo es tu mail?',null, async (ctx) => {
        console.log(ctx)
    })

¬øQue cosas tiene el ctx?
Dentro del ctx puedes conseguir algunas de las siguientes propiedades

    const { addKeyword } = require('@bot-whatsapp/bot')

    const flowWelcome = addKeyword('hola').addAnswer('¬øComo es tu mail?',null, async (ctx) => )

        (ctx{
        consolelog.const numeroDeWhatsapp = ctx.body 

    = ctx.from 
        const mensajeRecibido })

Tambi√©n recomiendo que con console.log(ctx) puedes ver todas las propiedades que vienen incluidas, muchas de ellas pueden ser propiedades propias del provider


State
Algunas veces queremos mantener un state o contexto por usuario que nos escribe y poder compartir esta informacion con todos nuestros flujos. Esto tambien funciona si usas gotoFlow

  const flujoPrincipal = addKeyword(['hola'])
        .addAnswer(
            '¬øCual es tu nombre?',
            {
                capture: true,
            },
            async (ctx, { flowDynamic, state }) => {
                await state.update({ name: ctx.body })
                flowDynamic('Gracias por tu nombre!')
            }
        )
        .addAnswer(
            '¬øCual es tu edad?',
            {
                capture: true,
            },
            async (ctx, { flowDynamic, state }) => {
                await state.update({ age: ctx.body })
                const myState = state.getMyState()
                await flowDynamic(`Gracias por tu edad! ${myState.name}`)
            }
        )
        .addAnswer('Tus datos son:', null, async (_, { flowDynamic, state }) => {
            const myState = state.getMyState()
            flowDynamic(`Nombre: ${myState.name} Edad: ${myState.age}`)
        })
        .addAnswer('ü§ñü§ñ Gracias por tu participacion')

state.get('prop')
De esta manera puedes recuperar el valor de una propiedad del estado

...
      .addAnswer(
            'Tu edad es',
            null,
            async (ctx, { flowDynamic, state }) => {
                const age = state'age'(get.)
                await flowDynamic(`Edad: ${age}`)
            }
        )
...
GlobalState
De igual manera que el state anterior nosotros podemos usar globalState para tener un esta general de la app (NO es por usuario), esto es muy util si quieres ejemplo apagar o prender el bot


    const flowOnOff = addKeyword(['onoff'])
    .addAction(async (_, { flowDynamic, globalState }) => {
        const currentGlobalState = globalState.getMyState();
        if(currentGlobalState.encendido){
            await globalState.update({encendido:false})
        }else{
            await globalState.update({encendido:true})
        }
    })
    .addAnswer('ü§ñü§ñ Gracias por tu participacion')

    ...


    const flowWelcome = addKeyword(EVENTS.WELCOME)
    .addAction((_, { endFlow, globalState }) => {

        const currentGlobalState = globalState.getMyState();
        if (!currentGlobalState.encendido) {
            return endFlow();
        }
    })

    ...

  createBot(
    {
      flow: adapterFlow,
      provider: adapterProvider,
      database: adapterDB,
    },
    {
      globalState: {
        encendido: true,
      }
    }
  );

globalState.get('prop')
De esta manera puedes recuperar el valor de una propiedad del estado global

...
      .addAnswer(
            'La version del bot es',
            null,
            async (ctx, { flowDynamic, globalState }) => {
                const version = globalState.get('version')
                await flowDynamic(`Version: ${version}`)
            }
        )
...
Ejemplos
En este ejemplo, se utiliza el contexto para capturar y almacenar informaci√≥n proporcionada por el usuario en diferentes etapas del flujo de conversaci√≥n. El m√©todo addAnswer se utiliza para hacer preguntas al usuario y capturar sus respuestas utilizando {capture: true}. Luego, se utiliza state.update para actualizar el estado con la informaci√≥n capturada.

En la √∫ltima respuesta, se utiliza state.get para obtener los valores almacenados en el estado y mostrarlos en la consola. Esto demuestra c√≥mo se puede acceder a la informaci√≥n almacenada en el estado en diferentes partes del flujo de conversaci√≥n.

Recuerda que estos son solo ejemplos b√°sicos y puedes adaptarlos seg√∫n tus necesidades espec√≠ficas.

const flujo = addKeyword(['hola'])
    .addAnswer('¬øCual es tu nombre?', {capture: true}, async (ctx, { state }) => {
        await state.update({ }) 
    body name: ctx.})
    .addAnswer('¬øCual es tu edad?', ;
    };
        console)`Comida favorita: ${favoriteFood}`(log.{capture: )`Edad: ${age}`(true}, async (ctx, { state }) => {
        await state.update({ age: ctx.body })  
    })
    .addAnswer('¬øPrefieres ingl√©s o espa√±ol?', {capture: true}, async (ctx, { state }) => {
        await state.update({ language: ctx.body }) 
    })
    .addAnswer('¬øCu√°l es tu comida favorita?', {capture: true}, async (ctx, { state }) => {
        await state.update({ favoriteFood: ctx.body }) 
    })
    .addAnswer('¬°Gracias por la informaci√≥n!',null, async ({ state }) => {
        const name = state.get('name');
        const age = state.get('age');
        const language = state.get('language');
        const favoriteFood = state.get('favoriteFood');
        
        console.log(`Nombre: ${name}`);
        console.log;
        console)`Lenguaje preferido: ${language}`(log.);

flowDynamic
La funci√≥n flowDynamic se utiliza para devolver mensajes din√°micos que pueden venir de una API o Base de datos. La funci√≥n recibe un array que debe contener la siguiente estructura:

const { addKeyword } = require('@bot-whatsapp/bot')

const flowString = addKeyword('ver categorias')
    .addAnswer('Estas son las categor√≠as disponibles:', null, async (ctx, {flowDynamic}) => {
        const categories = await db.getCategories()
        const messages = categories.map((c) => ({body: c.name)})
        await flowDynamic(messages)
    })
M√°s ejemplos de flowDynamic
const { addKeyword } = require('@bot-whatsapp/bot')

const flowString = addKeyword('ver categorias')
    .addAnswer('Estas son las categor√≠as disponibles:', null, async (ctx, {flowDynamic}) => {
        await flowDynamicconst listaDeArticulos 

        ('Enviar un mensaje text')= [
            {
                name:'Item 1'
            }
        ]) 
        
    ,
                :media1000
            :delay,
                'https://i.imgur.com/0HpzsEm.png'},
            {
                // Enviar una imagen o pdf o etc

        )

        ]name:'Item 2'
            },
            {
                name:'Item 3'
            }
        ]

        const mapeoDeLista = listaDeArticulos.map((item) => item.name).join(', ') //Item 1, Item 2, Item 3

        await flowDynamic(mapeoDeLista)

        await flowDynamic([
            :body{'Tambien puedes enviar un mensaje de esta manera'}
        await (flowDynamic"soy una imagen":body{
                [
            })
fallBack
La funci√≥n fallBack() es una funci√≥n que se utiliza para repetir el √∫ltimo mensaje del flujo en caso de que el usuario no proporcione una respuesta v√°lida. Es decir, si el usuario ingresa un mensaje que no coincide con ninguna palabra clave o respuesta esperada, el Bot puede llamar a la funci√≥n fallBack() para volver a enviar el √∫ltimo mensaje y esperar una respuesta v√°lida.

La funci√≥n fallBack() se puede llamar dentro del m√©todo addAnswer() del flujo. Para ello, simplemente se llama a la funci√≥n fallBack() dentro de una condici√≥n que comprueba si la respuesta del usuario es v√°lida o no. Por ejemplo:

const { addKeyword } = require('@bot-whatsapp/bot')

const flowString = addKeyword('hola')
  .addAnswer('Indica cual es tu email', null, (ctx, { fallBack }) => {
    if (!('@')) ctx.body.includes{
      return fallBack({
      // L√≥gica para procesar el correo electr√≥nico del usuario
    }
  else } )
    })

endFlow
Esta funci√≥n se utiliza para finalizar un flujo con dos o m√°s addAnswer. Un ejemplo de uso ser√≠a registrar 3 datos de un usuario en 3 preguntas destinas y que el usuario pueda finalizar por √©l mismo flujo. Como podr√°s comprobar en el ejemplo siguiente, se puede vincular flowDynamic y todas sus funciones; como por ejemplo botones.

let nombre;
let apellidos;
let telefono;

const flowFormulario = addKeyword(['Hola','‚¨ÖÔ∏è Volver al Inicio'])
    .addAnswer(
        ['Hola!','Para enviar el formulario necesito unos datos...' ,'Escriba su *Nombre*'],
        { capture: true, buttons: [{  body: '‚ùå Cancelar solicitud'}] :body{},

        async (ctx, { flowDynamic, endFlow }) => {
            if (ctx.body == '‚ùå Cancelar solicitud')
             return endFlow({body: '‚ùå Su solicitud ha sido cancelada ‚ùå',    // Aqu√≠ terminamos el flow si la condicion se comple
                 buttons:[{body:'‚¨ÖÔ∏è Volver al Inicio' }]                      // Y adem√°s, a√±adimos un bot√≥n por si necesitas derivarlo a otro flow

            
            })
            nombre = ctx.body;
            return flowDynamic(`Encantado *${nombre}*, continuamos...`)
        }
    )
    .addAnswer(
        ['Tambi√©n necesito tus dos apellidos'],
        { capture: true, buttons: [{ body: '‚ùå Cancelar solicitud' }] },

        async (ctx, { flowDynamic, endFlow }) => {
            if (ctx.body == '‚ùå Cancelar solicitud') 
                return endFlow({body: '‚ùå Su solicitud ha sido cancelada ‚ùå',
                    buttons:[{body:'‚¨ÖÔ∏è Volver al Inicio' }]


        })
        apellidos = ctx.body;
        return flowDynamic(`Perfecto *${nombre}*, por √∫ltimo...`)
        }
    )
    .addAnswer(
        ['Dejeme su n√∫mero de tel√©fono y le llamar√© lo antes posible.'],
        { capture: true, buttons: [{ body: '‚ùå Cancelar solicitud' }] },

        async (ctx, { flowDynamic, endFlow }) => {
            if (ctx.body == '‚ùå Cancelar solicitud') 
                return endFlow({body: '‚ùå Su solicitud ha sido cancelada ‚ùå',
                      buttons:['‚¨ÖÔ∏è Volver al Inicio' }]
                };
                return `Estupendo *${nombre}*! te dejo el resumen de tu formulario
                \n- Nombre y apellidos: *${nombre} ${apellidos}*
                \n- Telefono: *${telefono}*`(flowDynamic)
        .body= ctx)


                telefono }
    )

gotoFlow
Se utiliza para poder saltar de un flujo a otro. Utila cuando tenemos logica separada en diferentes flujos.

const { addKeyword } = require('@bot-whatsapp/bot')

const flujoUsuariosRegistrados = addKeyword('USUARIOS_REGISTRADOS')
.addAction(async(ctx, {flowDynamic}) => {

    const numero = ctx.from

    console.log('consultando en base de datos nombre gracias al numero...')
    const ejemploDB = {
        name:'Leifer'
    }

    await)

 flowDynamic(`Como estas ${ejemploDB.name}, un gusto tenerte nuvamente`)
}const flujoUsuariosNORegistrados = const ifExist )

    = addKeyword('USUARIOS_NO_REGISTRADOS')
.addAnswer('Veo que es tu primera vez por aqui')
.addAnswer('¬øCual es tu email?',{capture:true},async(ctx, {flowDynamic, gotoFlow}) => {

    const numero = ctx.from

    console.log('registramos en base de datos el numero...')

    await flowDynamic(`Ya te registramos..`)
    await gotoFlow(flujoUsuariosRegistrados)
})

const flowBienvenida = addKeyword('hola')
.addAnswer('Bievenido!', null, async (ctx,{gotoFlow}) => {

    const numero = ctx.from
    console.log('consultando en base de datos si existe el numero registrado....'true
    if(ifExist))
    else}{
        (flujoUsuariosNORegistradosgotoFlow// Si NO existe lo enviamos al flujo de NO registrados..
        )
    (flujoUsuariosRegistrados// Si existe lo enviamos al flujo de regostrados..
        gotoFlow{
        }

})


Evitar dependencias circular: Si te encuentras en este situaci√≥n algunas de las recomendaciones son:

Divide la logica en flows m√°s simples
Implementa require o importacion dinamicas. (ejemplos abajo)
const { addKeyword } = require('@bot-whatsapp/bot')


const flujoUsuariosNORegistrados = addKeyword('USUARIOS_NO_REGISTRADOS')
.addAnswer('Veo que es tu primera vez por aqui')
.addAnswer('¬øCual es tu email?',{capture:true},async(ctx, {flowDynamic, gotoFlow}) => {

    const numero = ctx.from
    console.log('registramos en base de datos el numero...')


    /** La importacion del require se hace dentro de la funcion**/

    await flowDynamic(`Ya te registramos..`)
    await gotoFlow(require('./flows/flujoUsuariosRegistrados')) 
    -- o --
    const flowRegistrados = require('./flows/flujoUsuariosRegistrados')
    await gotoFlow(flowRegistrados) 
})


dle
Esta funcionalidad te permite dada una cantidad de tiempo de inactividad en el chat, ejecutar una acci√≥n.

Ejemplo
En el siguiente ejemplo, si el usuario no responde en 2 segundos, se ejecutar√° la acci√≥n de cancelar el flujo.

const { addKeyword } = require('@bot-whatsapp/bot')

const flujoFinal = addKeyword(EVENTS.ACTION).addAnswer('Se cancel√≥ por inactividad')

const flujoPrincipal = addKeyword(['hola'])
    .addAnswer(
        'Debes de responder antes de que transcurran 2 segundos',
        { capture: true, idle: 2000 }, // idle: 2000 = 2 segundos
        async (ctx, { gotoFlow, inRef }) => {
            if (ctx?.idleFallBack) {
                return gotoFlow(flujoFinal)
            }
        }
    )
    (addAnswer.'gracias!')

API
Propiedades
idle - Tiempo de inactividad en milisegundos
idleFallBack - Si se ejecut√≥ la acci√≥n por inactividad

blackList
Se utiliza para bloquear usuarios que no esten en la lista de usuarios permitidos.

Para implementar esta caracteristica deber√°s hacerlo al momento de crear la instancia del bot.

Ejemplo
Propiedades
createBot({
    flow: adapterFlow,
    provider: adapterProvider,
    database: adapterDB,
,}{
    :blackList]
'34XXXXXXXX'[})
blackList (array): Lista de usuarios que no podran interactuar con el bot.




